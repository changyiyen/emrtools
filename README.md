# emrtools - toolkit for working with the NCKUH EMR system

## Overview

This toolkit was developed to assist in the processing of data from the NCKUH EMR system. It contains several command-line tools as well as a server providing a web interface to run these tools (for those who are command line-averse).

Currently the emrtools directory contents include (ignoring the RCS directories):

* cache - HTML reports generated by the tools

* tools - the command-line tools

* webui - Flask-powered web server providing a graphical interface

  * static - static files for the web pages

  * templates - templates provided to Flask for page generation

The command-line tools are:

* emr_diagnosis.py - lists all known problems for a patient for a given time period (*not* the ICD codes!)

* emr_diff.py - calculates diffs between notes for OPD visits for a patient for a given time period

  * Note: one side effect of using this tool is that the output makes doing a whole-text search for a particular word or phrase much easier (and, by extension, the time at which a particular diagnosis was made).

* emr_encounters.py - lists encounter codes for a patient for a given time period

* emr_nursing.py - prints nursing records for a patient for a particular encounter

* emr_orders.py - retrieves medical orders for a patient for a articular encounter

* emr_summary.py - generates a summary of patient events last night 

* emr_vitals.py - retrieves measurements of patient vitals

* ivue_scraper.py - simple screen scraper for Philips iVue systems

## Dependencies

All files were written for Python 3.6+. Dependencies include [BeautifulSoup](https://www.crummy.com/software/BeautifulSoup/) (bs4) (for page parsing), [lxml](https://lxml.de/parsing.html) (BeautifulSoup dependency) and [Flask](https://palletsprojects.com/p/flask/) (for the server). All dependencies can be installed with Pip3, e.g.:

```shell
pip3 install beautifulsoup4
pip3 install lxml
pip3 install Flask
```

## Examples

* To get an HTML report of diagnoses made, in chronological order:

```shell
python3 emr_diagnosis.py --uid 123456 --passwd n@800101 --chartno 12345678 --startdate 2018-01-01 --enddate 2019-07-01
```

* To get an HTML report of diffs between OPD notes:

```shell
python3 emr_diff.py --uid 123456 --passwd n@800101 --chartno 12345678 --startdate 2018-01-01 --enddate 2019-07-01
```

* To get a CSV list of encounter IDs for a patient:

```shell
python3 emr_encounters.py --uid 123456 --passwd n@800101 --chartno 12345678 --startdate 2018-01-01 --enddate 2019-07-01
```

* To retrieve all body temperature records from a Philips iVue server and output the information to a CSV file:

```shell
python3 ivue_scraper.py --allrecords --chartno 12345678 --encounterid I1234567890 --mode temp
```

## License

emrtools is licensed under the coffeeware license, itself a lightly modified beerware license.
